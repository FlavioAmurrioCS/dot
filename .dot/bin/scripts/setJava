#!/usr/bin/env bash

# shellcheck source=../scripts/__script_utilities.sh
SCRIPT_HOME="$(dirname "$(cd "$(dirname "${0}")" >/dev/null 2>&1 && pwd -P)")/scripts" &&
  [ -f "${SCRIPT_HOME}/__script_utilities.sh" ] &&
  source "${SCRIPT_HOME}/__script_utilities.sh"

onlyOnMac && function findJavaHome() { find /Library/Java "${HOME}/Applications" "${HOME}/.sw" -type f -perm +111 -name javac 2>/dev/null; }
onlyOnLinux && function findJavaHome() { find / "${HOME}/.sw" -executable -type f -name javac 2>/dev/null; }

function setJava() {
  helpArgCountUsage 0 "${FUNCNAME[0]}" "${@}" && return 0
  log_warning "Looking for existing hava installations..."
  local javahome
  javahome=$(findJavaHome | grep "/bin/" | sed 's|/bin.*||' | fzfSelectOne) || return 1
  ln -sfn "${javahome}" "${HOME}/.java_home"
  log_success "Setting ${javahome} as JAVA_HOME."
  "${HOME}/.java_home/bin/java" -version
}

setJava "${@}"
